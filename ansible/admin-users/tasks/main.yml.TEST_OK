---
# tasks file for test-user
#- name: Configure pubkeys for users
#  authorized_key: key="{{ lookup('file', lookup('first_found', dict(files=['devops/' + {{ item.value.keyfile}} , '/dev/null'], skip=true)))}}"  user= "{{ item.value.lanid }}"
#  with_dict: "{{ devops_users }}"
#  #with_items:
#  #    - "{{userlist}}"
#  ignore_errors: true
#
- name: 'Set authorized key'
  authorized_key:
    user: "{{ item.value.lanid }}"
    state: present
    #key: "{{ lookup('file', '{{ item.value.keyfile }}') }}"
    key: " {{ lookup('file', lookup('first_found', dict(files=['devops/' + '{{ item.value.keyfile }}' , '/dev/null'], skip=true)))}} "
  with_dict: "{{ devops_users }}"
  when: "item.value.active == 'Y'"
  ignore_errors: yes

  #- name: 'Check for key file'
#  local_action: stat path="/home/guagga01/Desktop/various-tools/ansible/admin-users/files/guagga01.pubo"
#  register: keyfile_user 
##
#- debug: 
#    msg: "Output value is {{ keyfile_user }}"
#  when: keyfile_user.stat.exists == true 
##
#- debug:
#    msg: "System {{ inventory_hostname }} has uuid {{ ansible_product_uuid }}"
